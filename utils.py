import cv2
import math
import os
from time import time
import numpy as np

luminance_quant_table = np.array([
    16, 11, 10, 16, 24, 40, 51, 61,
    12, 12, 14, 19, 26, 58, 60, 55,
    14, 13, 16, 24, 40, 57, 69, 56,
    14, 17, 22, 29, 51, 87, 80, 62,
    18, 22, 37, 56, 68, 109, 103, 77,
    24, 35, 55, 64, 81, 104, 113, 92,
    49, 64, 78, 87, 103, 121, 120, 101,
    72, 92, 95, 98, 112, 100, 103, 99], dtype=np.int64)

chrominance_quant_table = np.array([
    17, 18, 24, 47, 99, 99, 99, 99,
    18, 21, 26, 66, 99, 99, 99, 99,
    24, 26, 56, 99, 99, 99, 99, 99,
    47, 66, 99, 99, 99, 99, 99, 99,
    99, 99, 99, 99, 99, 99, 99, 99,
    99, 99, 99, 99, 99, 99, 99, 99,
    99, 99, 99, 99, 99, 99, 99, 99,
    99, 99, 99, 99, 99, 99, 99, 99
], dtype=np.int64)


def crop4interpolation(x, scale):
    h = x.shape[0]
    w = x.shape[1]
    h = h - h % scale
    w = w - w % scale
    return x[0:h, 0:w]


def list_filter(file_list, tail):
    r = []
    for f in file_list:
        s = os.path.splitext(f)
        if s[1] == tail:
            r.append(f)
    return r


def get_Y(x):
    r = x[:, :, 0]
    g = x[:, :, 1]
    b = x[:, :, 2]
    y = 0.257 * r + 0.504 * g + 0.098 * b + 0.0627
    return y


def calc_PSNR(x, y):
    mse = np.mean(np.square(x - y))
    psnr = 10 * math.log10(1 / mse)
    return psnr


def get_table(x, QF):
    if QF < 50:
        scale = int(5000 / QF)
    else:
        scale = 200 - QF * 2
    _table = (x * scale + 50) / 100
    _table = _table.astype(np.int32)
    _table[_table > 255] = 255
    _table[_table < 1] = 1
    _table = _table.astype(np.float32)
    _table = _table / 255.0
    _table = _table.reshape(8, 8)
    return _table


def generate_sigma(QF):
    if QF == 10:
        sigma_b = np.array([[0.0639223524554, 0.0584782627864, 0.0575871727683, 0.0566616187916, 0.056207865865,
                             0.0560594308193, 0.05540497473, 0.0597576844021, 0.059770079061, 0.0554220213607,
                             0.0560501905126, 0.0562129297744, 0.0566728699253, 0.0575754095196, 0.0583943690076,
                             0.0638473745293],
                            [0.0586172503575, 0.0555354097628, 0.0539093893566, 0.0530586901, 0.0526317075444,
                             0.0524322484035, 0.0525554266558, 0.0542014249041, 0.0541808633076, 0.0526070039602,
                             0.052434070408, 0.0526360804019, 0.0530249759718, 0.0538642401852, 0.0555015052723,
                             0.0585736562016],
                            [0.0573284319818, 0.0536735208827, 0.0524881753575, 0.0517336729127, 0.0514298245083,
                             0.0513094105206, 0.0510230081523, 0.0533431944777, 0.053307279854, 0.0510826662175,
                             0.051305696736, 0.0514210371803, 0.0517356202217, 0.0524409561397, 0.0536778160033,
                             0.0573935716894],
                            [0.0565008812907, 0.0528997015792, 0.0517840542158, 0.0511682664402, 0.0509381662919,
                             0.0508957469818, 0.0506698369461, 0.0529575225214, 0.0529343417719, 0.0506728800939,
                             0.0508310301423, 0.0509082495719, 0.0511594831438, 0.0517559446997, 0.0528795982807,
                             0.056596517082],
                            [0.0560694396688, 0.0524741121043, 0.0514960755552, 0.0509427061859, 0.0507885653268,
                             0.0507670770032, 0.0505395221609, 0.0528828951448, 0.0528148181606, 0.0505294509071,
                             0.0507178850956, 0.0507606961605, 0.0509564342099, 0.0514722794475, 0.0524709056646,
                             0.0561258113176],
                            [0.0558385067913, 0.0522475537119, 0.0513046645749, 0.0508381573109, 0.0507059639996,
                             0.0506637016982, 0.0504774557415, 0.0528525032828, 0.0527963025931, 0.0504750840658,
                             0.050648632937, 0.0506866509611, 0.0508276262996, 0.0513027082953, 0.0522151396185,
                             0.0558478624052],
                            [0.0555065412197, 0.0525452811464, 0.0512298889055, 0.0507660004842, 0.0506280632127,
                             0.0505935547282, 0.0508675922425, 0.0526586423914, 0.0525739409586, 0.0508710407604,
                             0.0506515910469, 0.0506679937348, 0.0507290496868, 0.0512067889564, 0.0525104436677,
                             0.0555170163951],
                            [0.059570228965, 0.0538439514123, 0.0533870444191, 0.0528536548225, 0.0527442550281,
                             0.0528506136581, 0.0523329986967, 0.0570768155947, 0.0569610547704, 0.0522804274574,
                             0.0528482807011, 0.0527735591508, 0.0528742817837, 0.0533817631475, 0.0538158460664,
                             0.0596215989413],
                            [0.0596288788887, 0.0538792123925, 0.0533942822371, 0.052921065569, 0.0527571684837,
                             0.052833736009, 0.0522652447055, 0.0570108427131, 0.0569980671541, 0.0523339767312,
                             0.0528493603368, 0.05280100827, 0.0528845735594, 0.0533877826075, 0.0538285110942,
                             0.0595401612525],
                            [0.0555501047201, 0.0525577939582, 0.0512659154014, 0.0507885953156, 0.0506653420517,
                             0.0506395598705, 0.0508813465319, 0.052656577621, 0.0526010657485, 0.0509452895999,
                             0.0506804921076, 0.0507086126202, 0.050821860511, 0.0512434277879, 0.0524991584466,
                             0.0555277217088],
                            [0.055850916779, 0.0522674019498, 0.0513116210378, 0.050864562069, 0.0507008048495,
                             0.0506867817627, 0.0504890710849, 0.0528313824518, 0.0528117227849, 0.0505108316648,
                             0.0506773834252, 0.0506877018855, 0.0508416202855, 0.0512694255382, 0.0522448403504,
                             0.0558500991952],
                            [0.0561049825455, 0.0524895024214, 0.0514724414475, 0.0509317965471, 0.0507743276567,
                             0.0507714995043, 0.050562476855, 0.0529026784744, 0.0528254029577, 0.0505697475936,
                             0.0507683474501, 0.0508088526362, 0.0509545607538, 0.0514464299941, 0.0524654528498,
                             0.0561074686603],
                            [0.0566066417651, 0.0529411899029, 0.0517865550253, 0.0511887210837, 0.0509558550475,
                             0.050938865537, 0.0506679607954, 0.0530284055691, 0.0529481239244, 0.0506949140005,
                             0.0509269280403, 0.0510064658069, 0.0512078464699, 0.0517651223736, 0.0529088735374,
                             0.0566245426551],
                            [0.0574299419071, 0.0537386214077, 0.052484940274, 0.051755246812, 0.0514381863938,
                             0.0513385489595, 0.0510880824056, 0.0533776908969, 0.0533555277436, 0.0511311470936,
                             0.0513032717196, 0.0514578545351, 0.0517807189007, 0.0525031897468, 0.0537276328383,
                             0.0574506956696],
                            [0.0586092628279, 0.0555698828601, 0.0538739754976, 0.0530431065953, 0.0526678112426,
                             0.0524608963944, 0.0526049021357, 0.0542402224779, 0.0541471281402, 0.0526091401074,
                             0.0524607630791, 0.0526061203466, 0.0530602249733, 0.0538872150324, 0.0555300473108,
                             0.0586387559972],
                            [0.0639083099939, 0.0585019171973, 0.0576320047947, 0.0567231138889, 0.0562494891466,
                             0.0561154286076, 0.0554300584424, 0.0598691734202, 0.059752034978, 0.0554820222488,
                             0.0560786402135, 0.0562289258903, 0.0567363320271, 0.0576194950981, 0.0584837419637,
                             0.0640379400634]], dtype=np.float32)
        sigma_g = np.array([[0.0496907959175, 0.0444195750338, 0.0446207768781, 0.0442322467348, 0.0441619446055,
                             0.0443183236329, 0.0438104983105, 0.0487769080949, 0.0488933892133, 0.0437825808321,
                             0.0443348892111, 0.0441387195094, 0.0442142746532, 0.0446257207959, 0.0443607582483,
                             0.049611898516],
                            [0.0447492027046, 0.0430007050908, 0.042225554494, 0.0419413947402, 0.0418446395571,
                             0.0419352200595, 0.0424544552093, 0.0438082999858, 0.0438689103599, 0.0424761334364,
                             0.0418985020604, 0.0418531685437, 0.0419147675807, 0.042188973433, 0.0429803276367,
                             0.0446500289262],
                            [0.0444898864872, 0.0419842275094, 0.0418006152359, 0.0415159402796, 0.0414678749877,
                             0.0415852588142, 0.0415212262787, 0.0437343303266, 0.0437522417022, 0.0415362374946,
                             0.0415668805986, 0.0414846579212, 0.0415488085462, 0.0417738673291, 0.0420170386572,
                             0.0444758100353],
                            [0.044270100659, 0.0418262974593, 0.0416225057945, 0.0413511412989, 0.0412785995823,
                             0.0414342816084, 0.0414404810319, 0.0435725827973, 0.0436018957143, 0.0414264218604,
                             0.0414407893132, 0.0412819996229, 0.0413483793834, 0.0415974662106, 0.0418129731203,
                             0.0442752759188],
                            [0.0441840783065, 0.0417223130681, 0.0416034261389, 0.0412757342712, 0.041244299368,
                             0.0414213951305, 0.0413905760284, 0.0435780624068, 0.043590932486, 0.0413843202941,
                             0.0414065496368, 0.0412361859293, 0.0413008210556, 0.0415578672565, 0.0417147485395,
                             0.0441618197926],
                            [0.0442124068984, 0.0417432411443, 0.0416032283015, 0.0413696815907, 0.0413054394397,
                             0.0414070821069, 0.0414229142175, 0.04360087792, 0.0436248136261, 0.0413955574492,
                             0.0414180159129, 0.0412894210501, 0.0413332031874, 0.0415583962806, 0.0416946426605,
                             0.0441680491985],
                            [0.0440899274407, 0.0424744762888, 0.0417401747731, 0.0415514952773, 0.0414949830694,
                             0.0415785693973, 0.0421756480018, 0.0436212043747, 0.0435413347613, 0.0421775596321,
                             0.0416250365303, 0.041527918193, 0.0415437233386, 0.0417517180751, 0.0424841459013,
                             0.0441166992427],
                            [0.048835625943, 0.0434911281157, 0.0438620331003, 0.0435096266502, 0.0434767994558,
                             0.0437426572527, 0.0432420784252, 0.0483882731911, 0.0483381078047, 0.04319114327,
                             0.0437192667073, 0.0434841291146, 0.0435450445671, 0.0438713452161, 0.0434815070797,
                             0.0488373863543],
                            [0.0489465024096, 0.0435659515479, 0.0439288925633, 0.0435943811227, 0.0435034781801,
                             0.0437432837592, 0.043240727781, 0.0483352719092, 0.0484144924655, 0.0432847809975,
                             0.0437772843905, 0.0435378713787, 0.0435603855782, 0.0439084903437, 0.043512686857,
                             0.0487821519204],
                            [0.0441813068166, 0.0424846584644, 0.0417890055835, 0.0415380340583, 0.0415174284457,
                             0.0415968423042, 0.0421722857549, 0.0435457525006, 0.0435812090629, 0.0422393018782,
                             0.0416237255515, 0.0415206250962, 0.0415720323194, 0.0417625069379, 0.0424448780038,
                             0.0441040640431],
                            [0.0442197537095, 0.0417404037971, 0.0415992316361, 0.0413686078039, 0.0413079762608,
                             0.0414251740728, 0.0414265087515, 0.0436169647313, 0.0436499846592, 0.0414459617192,
                             0.0414474875384, 0.0412967792458, 0.0413610891927, 0.0415471294872, 0.041753806932,
                             0.0442165345071],
                            [0.0442162845616, 0.041741681651, 0.0416023804926, 0.0412985251758, 0.0412702691125,
                             0.041463521427, 0.0414071940649, 0.0435880611088, 0.0436345415781, 0.0414371957692,
                             0.0414435792193, 0.0412602222076, 0.0413161868852, 0.0415824444552, 0.0417310004695,
                             0.0441743786682],
                            [0.0443507125906, 0.0418806959159, 0.0416960312168, 0.0414004619346, 0.0413390414117,
                             0.0415170126621, 0.0414363934899, 0.0436781439431, 0.0436969051512, 0.0414767085657,
                             0.0415114203582, 0.0413446375096, 0.0414164177171, 0.0416609702274, 0.0418293505988,
                             0.044309024915],
                            [0.0445706423292, 0.0420612138913, 0.0418370422068, 0.0415674927855, 0.041493495455,
                             0.0416300189019, 0.0415688356166, 0.0437700688171, 0.0438380581368, 0.0416329871016,
                             0.041591758604, 0.0414951597361, 0.0415901314165, 0.0418499126841, 0.0420246525581,
                             0.0445514940298],
                            [0.0447347493598, 0.0430501637898, 0.0422512293697, 0.0419732752336, 0.0419177383717,
                             0.0419774061825, 0.042544022835, 0.0439050584699, 0.043871648163, 0.0425233687178,
                             0.0420053014842, 0.0418632457394, 0.0419804245541, 0.042233511677, 0.0430569019507,
                             0.0447460704444],
                            [0.0496321309508, 0.0443994338453, 0.0446376157766, 0.0442658188133, 0.0441844038186,
                             0.0444007364926, 0.043854458766, 0.0489506480857, 0.048878101584, 0.0438612668411,
                             0.044385602834, 0.0441834737879, 0.0442807562366, 0.0446488642668, 0.0444021723996,
                             0.0497141827045]], dtype=np.float32)
        sigma_r = np.array([[0.0576937995485, 0.0524554111303, 0.0520726742171, 0.051380660966, 0.0511011395871,
                             0.0511544344586, 0.0506853939058, 0.054944329246, 0.054993361561, 0.050642473875,
                             0.0511620334664, 0.0510520753309, 0.0513271115494, 0.0520357607454, 0.0523720463806,
                             0.0575472616936],
                            [0.0526804207721, 0.0502789174955, 0.0490357885845, 0.0484550932467, 0.0481835225595,
                             0.0482066206272, 0.0486334961126, 0.0497785401034, 0.0498173386919, 0.0486309188187,
                             0.0481892203037, 0.0481645287556, 0.0484037849616, 0.0490098677349, 0.0502617058233,
                             0.052598329939],
                            [0.0518579557083, 0.0487868608998, 0.0480547265613, 0.0475465723976, 0.0473475518402,
                             0.0474097756244, 0.0473447357725, 0.049271211557, 0.0492418148736, 0.047349731024,
                             0.0474217156127, 0.0473736430449, 0.0475490072871, 0.0480564863432, 0.0488442918567,
                             0.0518840421331],
                            [0.051333121913, 0.0483465756097, 0.0476176652499, 0.0471782867644, 0.0470311581132,
                             0.0471454848663, 0.0471427575036, 0.0489918684181, 0.0489931738451, 0.0471027418105,
                             0.0471566978525, 0.0470386238554, 0.0471828692049, 0.0476460156814, 0.0483391589743,
                             0.0513365662948],
                            [0.0510432386757, 0.0480556699231, 0.0474682951136, 0.0470223860166, 0.0469342312409,
                             0.0470881226384, 0.047021238233, 0.0489271698098, 0.04893374481, 0.0470154948979,
                             0.0470751522616, 0.046922049076, 0.0470230597074, 0.0474374680128, 0.0480753160887,
                             0.0510283337798],
                            [0.0509669809975, 0.0480218820279, 0.0474255036366, 0.0470884837409, 0.046956114725,
                             0.0470330574225, 0.0470413187597, 0.0489700230489, 0.048979194638, 0.0470080699594,
                             0.047049311834, 0.0469648001867, 0.0470254767372, 0.0474052097658, 0.0479902314447,
                             0.0509710655017],
                            [0.0508107122247, 0.0486234413096, 0.0475361170634, 0.047197667385, 0.047087482258,
                             0.0471652084486, 0.0476935042245, 0.0489775144375, 0.048899415403, 0.0476960987763,
                             0.047217115849, 0.0471285297431, 0.0471797860559, 0.0475101175214, 0.0485972420498,
                             0.0508749239792],
                            [0.0549665454182, 0.0495393126132, 0.0494082276972, 0.0489294851316, 0.0488413264596,
                             0.0490923826982, 0.0486520504067, 0.0532087667167, 0.0531965710939, 0.0486175899667,
                             0.0490688516993, 0.0488695170912, 0.0489410818223, 0.0494140766183, 0.0494806926654,
                             0.0549623799596],
                            [0.0549549828444, 0.0495283121363, 0.049411631502, 0.0489435440314, 0.0488346130604,
                             0.049060661101, 0.0486338151407, 0.0531557221471, 0.053221058673, 0.0486421411994,
                             0.04906443923, 0.0488603463343, 0.0489282460484, 0.0494291362753, 0.0495024501794,
                             0.0548981549369],
                            [0.0509036085557, 0.0486040851983, 0.0475310800478, 0.0471726093596, 0.0471169309645,
                             0.0471636821999, 0.0476718796031, 0.0489143334325, 0.0489162236784, 0.0477072490243,
                             0.0471985007799, 0.047107758212, 0.0471897998623, 0.0475633066703, 0.0485881111527,
                             0.0508517845385],
                            [0.0509737464039, 0.0479967835462, 0.0474316517145, 0.0470771332974, 0.0469679579663,
                             0.0470512056922, 0.0470457357821, 0.0489788358684, 0.048990565481, 0.0470625253255,
                             0.0470749512801, 0.0469646498688, 0.0470540112548, 0.0474108823113, 0.0480288292084,
                             0.0509795189341],
                            [0.0510765897166, 0.0480992895611, 0.047501060822, 0.0470339603033, 0.0469550461357,
                             0.0471179342782, 0.0470511629917, 0.0489322021216, 0.0489807613898, 0.0470730305354,
                             0.0471167409309, 0.0469715190089, 0.0471051570239, 0.0474968142617, 0.048075834613,
                             0.0510400236822],
                            [0.0513689668706, 0.0483763115154, 0.0476995715004, 0.0472179048733, 0.0470858876341,
                             0.0472141341655, 0.047117260581, 0.049042942634, 0.0491031667151, 0.0471397026787,
                             0.0472095490664, 0.0471077995148, 0.0472247482566, 0.0476634691575, 0.0483614004188,
                             0.0513552651514],
                            [0.0519395390783, 0.04886138721, 0.0480942253741, 0.0475886674417, 0.047394094253,
                             0.047475292072, 0.0473993378218, 0.0493018143904, 0.0493243251546, 0.0474252151493,
                             0.0474233755666, 0.0474133576807, 0.0476087907337, 0.0481436388693, 0.0488737812013,
                             0.0519351680433],
                            [0.0526648352231, 0.0502961968634, 0.0490369429591, 0.0484660904397, 0.0482371676751,
                             0.0482469450435, 0.0486791249796, 0.0498731658702, 0.0498274595842, 0.0486522598823,
                             0.0482592926051, 0.0482379287062, 0.0485111781658, 0.0490795778836, 0.0503684050372,
                             0.0526826249924],
                            [0.0576684532774, 0.0524592611619, 0.0521111821243, 0.0514326662994, 0.0511605097567,
                             0.0512637003614, 0.0507468203801, 0.0551407643218, 0.0550652738398, 0.0507565414289,
                             0.0512322980972, 0.0511574090571, 0.0514604792784, 0.0521336385796, 0.0524993530251,
                             0.0577813394119]], dtype=np.float32)
    elif QF == 20:
        sigma_b = np.array([[0.0497044146934, 0.0461188159084, 0.0444744027833, 0.0439450611907, 0.0436822474542,
                             0.0434955075704, 0.0434623884139, 0.0450701862038, 0.0450799599742, 0.043465676732,
                             0.0434823834368, 0.0437150948668, 0.0439305971259, 0.0444471407918, 0.0460543546004,
                             0.0495939430858],
                            [0.0462098596477, 0.0433264635032, 0.0414437891444, 0.0411007959896, 0.0410498136549,
                             0.0408510820206, 0.0411503546934, 0.0417289263933, 0.0417769101233, 0.0411775818478,
                             0.0408539201352, 0.041059651708, 0.0410862709149, 0.0414378388214, 0.04330084438,
                             0.0461461734568],
                            [0.0443740831144, 0.0414803848341, 0.0401515007688, 0.0399792035059, 0.0400718486878,
                             0.0399520207503, 0.0399302308385, 0.0406165758702, 0.0405998667517, 0.0399680082502,
                             0.0399542125086, 0.0400576000014, 0.0399894895952, 0.0401495612956, 0.0415034432516,
                             0.0444018905361],
                            [0.0438072178675, 0.0408911780663, 0.0399195669106, 0.0399558269842, 0.0400199206135,
                             0.0399329950391, 0.0397293399071, 0.0406383141666, 0.0406206788419, 0.0397452476168,
                             0.0398755791283, 0.0400519857697, 0.0399422772674, 0.039917050065, 0.040886778206,
                             0.0438286316388],
                            [0.0435929666783, 0.040860100249, 0.0400304757695, 0.0400734117113, 0.0401885538965,
                             0.0400626297087, 0.0398480485189, 0.0407820349313, 0.040759948572, 0.0398828506133,
                             0.040043035224, 0.0402114435286, 0.0400941795273, 0.0400085995367, 0.0408359594162,
                             0.0436075254038],
                            [0.0435046599068, 0.0410163487808, 0.0400848065772, 0.040120636694, 0.0401909336992,
                             0.0400785469533, 0.0400640462118, 0.0407965179216, 0.0407557633432, 0.0400542113702,
                             0.0400850643243, 0.0402174091093, 0.0401143867724, 0.0400711882061, 0.0410068152082,
                             0.0435032440215],
                            [0.0436303801357, 0.041218522487, 0.0399340137557, 0.0400097017384, 0.0401155589588,
                             0.0399540524247, 0.0402811740333, 0.0409621885942, 0.0408488001876, 0.0402740003144,
                             0.0399446089999, 0.0401350848681, 0.0400165691116, 0.0399429671941, 0.0412105950966,
                             0.043687112938],
                            [0.0449621554666, 0.0415262397786, 0.040570891803, 0.0406164522458, 0.0407170264582,
                             0.0406132486564, 0.0406232658608, 0.0424208275558, 0.0423255360135, 0.0406059965725,
                             0.0405714796992, 0.0407083397553, 0.0406352556141, 0.04056933151, 0.0414755525204,
                             0.0450047491764],
                            [0.045012969407, 0.0415778560012, 0.0405834734598, 0.0406793579288, 0.0407499954947,
                             0.0406012603717, 0.0405509603372, 0.0423550241938, 0.0423487653997, 0.0406263690707,
                             0.0406080798159, 0.0407555708068, 0.0406238400007, 0.0405881504961, 0.0415014719138,
                             0.0449600127999],
                            [0.0437296104668, 0.0412672165705, 0.0399859046403, 0.0400618112029, 0.0401535893472,
                             0.0399553775673, 0.0402585131525, 0.0409282129136, 0.040945979439, 0.0403261954315,
                             0.0400103782362, 0.0401609909587, 0.0400456322965, 0.0399645240558, 0.0412248894657,
                             0.0437010538543],
                            [0.0435152218513, 0.0410259503488, 0.0401125749123, 0.0401501632206, 0.0402386705561,
                             0.0401293972501, 0.0400860669727, 0.0408093835569, 0.040739647874, 0.0400844983307,
                             0.0401254908403, 0.0402325978678, 0.0401076988019, 0.0400996311962, 0.0410551431384,
                             0.0435539676084],
                            [0.0436109970354, 0.0408844100313, 0.0400542326297, 0.0401055703312, 0.0402241011317,
                             0.040064614968, 0.039899531012, 0.0408355583234, 0.0407923091365, 0.0399039210485,
                             0.0400657623902, 0.0402091180022, 0.0401027873417, 0.0400352225182, 0.0408716009327,
                             0.0436579976025],
                            [0.0438053121231, 0.040896944731, 0.0399149581674, 0.0399419825706, 0.0400502969736,
                             0.0399657028596, 0.0397581710802, 0.0406852493269, 0.0406514380762, 0.0398011801337,
                             0.0399550872137, 0.0400834500496, 0.0399763178088, 0.0399050384403, 0.0409017871341,
                             0.0438343897882],
                            [0.0444079869261, 0.0415382629371, 0.0401752105939, 0.0400042614589, 0.0401021543372,
                             0.039993117011, 0.0399703441548, 0.0406566983653, 0.0406452336869, 0.0399816704914,
                             0.0400011286386, 0.0400917245078, 0.0400220348588, 0.0401829169202, 0.0415314536216,
                             0.0444303867584],
                            [0.0461678719301, 0.0433161298384, 0.041425208926, 0.0411133270071, 0.0410906167855,
                             0.0408449610285, 0.0411554057242, 0.0417944397705, 0.0417128456174, 0.0411764453629,
                             0.0408397768818, 0.0410017294938, 0.0411171357671, 0.0414653242007, 0.0433281428526,
                             0.0462775769081],
                            [0.0496897088142, 0.0461210832503, 0.0445046488686, 0.0439520925562, 0.0437320784245,
                             0.0435082120381, 0.0434810214754, 0.0451414563309, 0.0450798465673, 0.0435091118751,
                             0.0435150220651, 0.0437529021214, 0.0439609506692, 0.044520459676, 0.0461052732298,
                             0.0497715112697]], dtype=np.float32)
        sigma_g = np.array([[0.0357952400422, 0.0341672815356, 0.0333905703433, 0.0334312932108, 0.0333459531854,
                             0.0331530713185, 0.0336315576226, 0.0348065393753, 0.0348844484757, 0.0336262824614,
                             0.0331611168645, 0.0333798450395, 0.0334375612269, 0.0333873098676, 0.0341346312815,
                             0.0357246184374],
                            [0.0344562944816, 0.033905432687, 0.0328692863, 0.032995079225, 0.0329827043079,
                             0.0327104751808, 0.0335087937801, 0.0334712657605, 0.0335867007004, 0.0335354960537,
                             0.0326976158573, 0.0329808312553, 0.0329860212415, 0.0328674935785, 0.0338880092181,
                             0.034311250646],
                            [0.0335047500816, 0.0330427254136, 0.0323746075237, 0.0323969176299, 0.0324253498522,
                             0.0322604139854, 0.0327551990528, 0.0327576025387, 0.0327878515656, 0.0327738465572,
                             0.0322658311668, 0.0323837380282, 0.0324220306794, 0.0323957283252, 0.0330754851684,
                             0.0334883604016],
                            [0.0334208914231, 0.0327331135478, 0.0322337697201, 0.0323144128571, 0.0322475158766,
                             0.0321810605419, 0.0324831106165, 0.0327867751058, 0.0328236331051, 0.032505351764,
                             0.0321595660259, 0.0322843623509, 0.0322972551716, 0.0322366302507, 0.0327192533061,
                             0.0334097756012],
                            [0.0333665893523, 0.0326901636532, 0.0322608237782, 0.0323069465718, 0.03229181095,
                             0.0322008194051, 0.0324714652985, 0.0328270468059, 0.0328289479537, 0.0324923736331,
                             0.0321700376778, 0.0323006175545, 0.0322982085868, 0.0322395092918, 0.0326811564837,
                             0.0333475546835],
                            [0.033287101081, 0.0329169413139, 0.0323247152629, 0.0323835471557, 0.0323527248978,
                             0.0322354628995, 0.0327407551075, 0.0327260104276, 0.032752955256, 0.0327318569592,
                             0.0322299104054, 0.0323791025146, 0.0323901338593, 0.0323219916546, 0.0329289100483,
                             0.0332611850341],
                            [0.0338463488077, 0.033527433292, 0.0325586777105, 0.032795360313, 0.0327812427324,
                             0.0325300490451, 0.033344079494, 0.0334045810306, 0.0333149612237, 0.0333521914066,
                             0.0325139326133, 0.0328023924607, 0.0327986411011, 0.0326048286166, 0.0335209328292,
                             0.0339487265035],
                            [0.0348424621448, 0.0332963579055, 0.032665192666, 0.0328230096294, 0.0328185224094,
                             0.0326043653444, 0.0331209795156, 0.0343665189875, 0.0343610247107, 0.0331027335924,
                             0.032590228135, 0.0327995520949, 0.0328197878313, 0.0326739973464, 0.0332802111389,
                             0.0348836243181],
                            [0.0349060060528, 0.0333469535333, 0.0326761717585, 0.0328498679199, 0.0328158263278,
                             0.0326084375417, 0.0330696158577, 0.0343138219288, 0.0343638907133, 0.0331345273071,
                             0.0326524411678, 0.0328688965401, 0.0328357047886, 0.0326825560665, 0.0332887689085,
                             0.0348104154093],
                            [0.0339435323074, 0.033560191621, 0.0326039038895, 0.0328103523784, 0.0328001916078,
                             0.0325170077687, 0.03332129105, 0.0333247162735, 0.0334283131444, 0.0333492737647,
                             0.0325449297692, 0.0327802039328, 0.0327917217649, 0.0325759992396, 0.0335214005822,
                             0.0338619647832],
                            [0.033306686036, 0.0329414319448, 0.0323236624295, 0.0323957200285, 0.0323951178336,
                             0.032273264684, 0.0327373797323, 0.0327683911944, 0.0327573862762, 0.0327530598799,
                             0.0322820424054, 0.032376308521, 0.0323651288117, 0.0323200000689, 0.0329496340104,
                             0.0332822119452],
                            [0.0333781088146, 0.0327091396948, 0.0322629563176, 0.0323220404695, 0.0323090499564,
                             0.032212531922, 0.0325275721707, 0.0328428165819, 0.032870472123, 0.0325286538689,
                             0.0322301453854, 0.0323198742951, 0.0323268834675, 0.0322711455033, 0.0327117793213,
                             0.0333810344346],
                            [0.0334485620721, 0.0327590711493, 0.0322782349187, 0.032339856471, 0.0323132567566,
                             0.0322408616734, 0.032515041003, 0.0328460525355, 0.0328795403811, 0.0325349172029,
                             0.0322220809169, 0.0323258745837, 0.0323419813478, 0.0322669041688, 0.0327681173197,
                             0.0334357524971],
                            [0.0335593586858, 0.033109001308, 0.0324063756427, 0.0324511234268, 0.0324298846776,
                             0.032337008529, 0.0327995842932, 0.0328034279231, 0.0328685102974, 0.0328472385214,
                             0.0323429465106, 0.0324479831884, 0.0324651228069, 0.0324480017833, 0.0331182522995,
                             0.0335223206241],
                            [0.0344105124726, 0.0339476569361, 0.0329013410765, 0.0330456900352, 0.0330274244121,
                             0.0327551480998, 0.0335807987451, 0.0336276535067, 0.0335567459425, 0.0335753117228,
                             0.0327503418018, 0.0329920251991, 0.0330668459214, 0.0329191521603, 0.0339693818409,
                             0.0344836408407],
                            [0.0357672320632, 0.0341905641398, 0.0334124560285, 0.0334684675671, 0.0334176429453,
                             0.0332048331793, 0.0336916948531, 0.0349498323332, 0.0348958157785, 0.033700075127,
                             0.0332028463839, 0.0334344387721, 0.0334836146679, 0.0334428826807, 0.0341687469641,
                             0.0358150502026]], dtype=np.float32)
        sigma_r = np.array([[0.0433257178389, 0.040843556797, 0.039541845853, 0.0393084809444, 0.0391335429236,
                             0.0389076748968, 0.0393152183959, 0.0403309399896, 0.0403520086553, 0.03928532549,
                             0.0389358401063, 0.0391521338299, 0.0392913231598, 0.0395210188437, 0.0407977421235,
                             0.0432507689594],
                            [0.0409892778651, 0.0393068008689, 0.0378285157318, 0.0377457171059, 0.0376899965327,
                             0.0374288667953, 0.0381318206423, 0.0380868422284, 0.0381743392893, 0.0381394929797,
                             0.0374699270894, 0.0377029325534, 0.0377210623413, 0.0378151342111, 0.0392960419882,
                             0.0408994937265],
                            [0.0395255526627, 0.0379460270431, 0.0368988297071, 0.0368410354488, 0.0368772158873,
                             0.036744964455, 0.037125661463, 0.0371469995046, 0.0371432458003, 0.0371120784928,
                             0.0367445806123, 0.0368732393708, 0.0368671271432, 0.0368774908287, 0.0379610309304,
                             0.0395534189337],
                            [0.0392284070925, 0.0375429958503, 0.0367559950297, 0.0368192487661, 0.0368061845554,
                             0.0367143435283, 0.0369159914082, 0.0371930599561, 0.0372025439483, 0.0368925899147,
                             0.0366910046218, 0.0368106394179, 0.0367830870977, 0.0367523972523, 0.0375598698299,
                             0.0392679536387],
                            [0.0390997220634, 0.0374832104679, 0.0368018444361, 0.0368376622418, 0.0368879662074,
                             0.0367799236069, 0.0369514096972, 0.0372512101255, 0.037233574266, 0.0369650686505,
                             0.0367709546464, 0.0368702874528, 0.0368443953277, 0.0367800267781, 0.0375065807322,
                             0.0391050785371],
                            [0.0390038328412, 0.0376870411831, 0.0368256801166, 0.0368835425248, 0.0368989396151,
                             0.0367772680882, 0.0372004987267, 0.0371906121202, 0.0372105946731, 0.0371799256587,
                             0.0367953663624, 0.0369391977582, 0.0368901317268, 0.0368238689367, 0.0376872120536,
                             0.0389981171449],
                            [0.0394496923246, 0.0381766419949, 0.0369846837524, 0.0371615251284, 0.0371985593249,
                             0.0369932707706, 0.037688826681, 0.0377801561487, 0.0376621052372, 0.0376724558455,
                             0.0369781228914, 0.0372145958828, 0.0371736696612, 0.0369909553576, 0.0381583605766,
                             0.0395331538665],
                            [0.0403281689941, 0.0379857549912, 0.0370887579462, 0.0371989585396, 0.0372596054894,
                             0.0370566969447, 0.037511082765, 0.0386540827516, 0.038631295565, 0.0374847022987,
                             0.037093835117, 0.0372584159317, 0.0371890106557, 0.0370869410789, 0.0379551609346,
                             0.0403424846893],
                            [0.0403250495213, 0.0379784807999, 0.0370794452502, 0.03720940911, 0.0372327677799,
                             0.0370704720384, 0.0374613652867, 0.0386035345466, 0.0386149915606, 0.0374993613606,
                             0.0371003032182, 0.0372686992937, 0.0372045467341, 0.0371003824395, 0.0379612054342,
                             0.0403049377238],
                            [0.0395320328826, 0.0381610036153, 0.0369874269509, 0.0371867221632, 0.0371994101608,
                             0.0369455483544, 0.0376440673614, 0.0376873135405, 0.0377401068367, 0.0376633156637,
                             0.036999115703, 0.0371970413105, 0.0371688470432, 0.0369978572306, 0.0381516844822,
                             0.0394540271726],
                            [0.0389828148392, 0.0376628522588, 0.0368369770039, 0.0368997027314, 0.0369179052141,
                             0.0367975634674, 0.0371959487001, 0.037253898667, 0.0371829766911, 0.0371814086112,
                             0.0368097471358, 0.0369077557989, 0.036852601831, 0.0368089074112, 0.0377051885583,
                             0.039001200935],
                            [0.0390823441943, 0.037494802645, 0.0367841812159, 0.0368277275742, 0.0368890998572,
                             0.0367883905515, 0.0370124790446, 0.0372776311704, 0.0372863349768, 0.0369758921076,
                             0.0367898783384, 0.0368673794713, 0.0368624877455, 0.0367794179, 0.0375409556386,
                             0.0391115100159],
                            [0.0392385591416, 0.0375633597264, 0.0367696745215, 0.0368021257789, 0.0368361964883,
                             0.0367566702587, 0.0369304592628, 0.0372335490962, 0.0372425080948, 0.0369323627873,
                             0.0367484551482, 0.0368540759677, 0.0368121112074, 0.0367579108675, 0.037597068358,
                             0.0392286568643],
                            [0.039596392963, 0.0379982702468, 0.0369208935469, 0.0368940252541, 0.0368936751335,
                             0.0368094077589, 0.0371448103257, 0.0371625979921, 0.0371915518648, 0.0371852102329,
                             0.0368093571191, 0.0369221222815, 0.036897682174, 0.0369460300699, 0.0380241751833,
                             0.0395984682321],
                            [0.0409366825801, 0.0392821885782, 0.0378301099088, 0.0377627239605, 0.0377019771861,
                             0.0374930296251, 0.0381692925939, 0.0382355533568, 0.0381619289794, 0.038165925059,
                             0.0375100387232, 0.0377407591856, 0.0378203901321, 0.0378521973598, 0.0393771190895,
                             0.0410503203707],
                            [0.0433164870226, 0.0408532425457, 0.0395903657285, 0.0393592458159, 0.0392176152019,
                             0.0389961329546, 0.0394200227361, 0.0405107927132, 0.0404271582396, 0.0393810804265,
                             0.0390072218635, 0.039242602311, 0.039406871602, 0.0396444634957, 0.0408942851617,
                             0.043409009414]], dtype=np.float32)
    else:
        sigma_b = np.array([[0.0846821519498, 0.0782021681886, 0.0773813950126, 0.0763660869288, 0.0758959908146,
                             0.0759310701388, 0.0758424487449, 0.0817841633571, 0.0817289422401, 0.0758332290957,
                             0.0759636061441, 0.0759049051979, 0.0763045940455, 0.0773510325728, 0.0782078203715,
                             0.084699173508],
                            [0.0779344920717, 0.07389173601, 0.0731373034741, 0.0719503621327, 0.0714592121145,
                             0.071624204685, 0.0713217383218, 0.0746816392903, 0.0745692699255, 0.071348389432,
                             0.0716261515381, 0.0714129267632, 0.0718626442246, 0.0730979567032, 0.0738306826593,
                             0.0779854129117],
                            [0.0767485835942, 0.0727524924214, 0.0717900393501, 0.0706698484852, 0.0701726088893,
                             0.0702770193819, 0.0702171220039, 0.07349379338, 0.0733977035566, 0.0701980356336,
                             0.0702653658942, 0.0701563658759, 0.0705957378949, 0.0717531592486, 0.0727574843266,
                             0.0768692426565],
                            [0.075929823987, 0.071940582093, 0.0709969229527, 0.0699114559044, 0.0694670406907,
                             0.0696202232193, 0.0694661807588, 0.0727228448873, 0.0726423666064, 0.0694339476693,
                             0.069566703571, 0.0694205520869, 0.0698631305112, 0.0710073697802, 0.0719024760261,
                             0.0759939775477],
                            [0.0754801393691, 0.0714153702797, 0.070520201957, 0.0693965361998, 0.0690005704719,
                             0.0692267400125, 0.06905851905, 0.0723652825096, 0.0722882370716, 0.0690280985645,
                             0.06917134977, 0.0690020187497, 0.0693971664046, 0.0704973465747, 0.0714053374078,
                             0.0755562722255],
                            [0.0753201532961, 0.0711935872948, 0.070186554893, 0.0691589894052, 0.068765785173,
                             0.0689591879789, 0.0689521744648, 0.0723602259756, 0.072266957964, 0.0689322883537,
                             0.0689539556386, 0.0687569953018, 0.0691416741185, 0.0701664997164, 0.0711783735212,
                             0.0753687425998],
                            [0.0754362741177, 0.0711833568249, 0.0704214568552, 0.069325339401, 0.0689421500538,
                             0.0692434599555, 0.0690540182681, 0.0726175218077, 0.0725686229541, 0.0690555836155,
                             0.0692584240398, 0.0689584755068, 0.0692911944549, 0.0704251889935, 0.0712034073684,
                             0.0754784393231],
                            [0.0815496189126, 0.0747260170964, 0.0737989010902, 0.0728768623282, 0.0725571688156,
                             0.0727215016423, 0.0727903738002, 0.0791495484324, 0.07900813341, 0.0727474077081,
                             0.072664290734, 0.0724838668353, 0.0728367687347, 0.0737803646644, 0.0747024678724,
                             0.0817182052789],
                            [0.0815425696729, 0.0746909782872, 0.0738052553191, 0.0729105407137, 0.0725350833054,
                             0.0727023038754, 0.0727260219721, 0.0790131863262, 0.0790176363208, 0.0727469549803,
                             0.0726919289002, 0.0724971683158, 0.072844463757, 0.0737557031062, 0.0746766922919,
                             0.0815811302657],
                            [0.0754341469198, 0.0712333971149, 0.0704938295478, 0.0693549427533, 0.0689689131813,
                             0.0692167662021, 0.0690186399213, 0.0726246411752, 0.0725225114838, 0.0690792160095,
                             0.0692797363835, 0.0689872837269, 0.0693346150243, 0.07042599994, 0.0711256814121,
                             0.0754513037189],
                            [0.0753802362063, 0.0712174442263, 0.07020603334, 0.0692065080261, 0.0687662627275,
                             0.0689441382464, 0.0689385771247, 0.0723522122114, 0.0722479858044, 0.0689503714658,
                             0.0690196420269, 0.0687722503424, 0.0691558076714, 0.0701854450272, 0.0711509663054,
                             0.0753234043509],
                            [0.0754851347569, 0.0714511670258, 0.070523695285, 0.0694031935862, 0.068992382209,
                             0.0692008402047, 0.0690339496521, 0.0723863952619, 0.0722673684644, 0.0690535954167,
                             0.0692111447227, 0.0689828429948, 0.0694314079844, 0.0705016911023, 0.0713655251899,
                             0.0755116720938],
                            [0.0759711571747, 0.0719557362377, 0.0710255149898, 0.0698814486963, 0.0694324984207,
                             0.0696325917886, 0.0694193133169, 0.0727520443243, 0.0726413551555, 0.0694154333118,
                             0.0696289090596, 0.0694453720651, 0.0699363771732, 0.0709804639357, 0.0718718653437,
                             0.0760301578493],
                            [0.0768128775641, 0.0728348661501, 0.0717847657753, 0.0706335633794, 0.0701711623431,
                             0.0702737682228, 0.0701974659975, 0.0735022238606, 0.0734446369938, 0.0702291890893,
                             0.0703043534644, 0.0701867783033, 0.0706500079566, 0.0717648926511, 0.0727231770641,
                             0.0768339392879],
                            [0.0779911692377, 0.073913305309, 0.0731216456453, 0.0719310672486, 0.0714816153936,
                             0.0716379883737, 0.071336964644, 0.074678143444, 0.0746166997387, 0.071339506231,
                             0.071661217603, 0.0714300172692, 0.0719167546855, 0.0730889425369, 0.073873160575,
                             0.0780092976129],
                            [0.0847361892986, 0.0782891884803, 0.07739314377, 0.0763652738807, 0.0759211014478,
                             0.075980257813, 0.0758527816683, 0.0818500383031, 0.0817691096862, 0.0758746108706,
                             0.0759785645536, 0.075892173041, 0.0763428521653, 0.0773243932939, 0.0782336077745,
                             0.0848908319968]], dtype=np.float32)
        sigma_g = np.array([[0.0682705370102, 0.0604782186157, 0.0603785074648, 0.0597066996329, 0.0596207517718,
                             0.0601034777748, 0.0600645385144, 0.0675942121765, 0.0676685038107, 0.0600585010662,
                             0.0601389276221, 0.0596165300147, 0.0596749063731, 0.0603715841456, 0.0604826115069,
                             0.0681564743933],
                            [0.0602528468634, 0.0559347649331, 0.0560386982449, 0.0551535311713, 0.0550583491306,
                             0.0557894595352, 0.0554581050351, 0.0595548633004, 0.0595234602484, 0.0554975655183,
                             0.0557912581066, 0.0550280669192, 0.0550997070233, 0.0560489797668, 0.0559341570031,
                             0.060227989187],
                            [0.0597616208171, 0.0555572373176, 0.0553971731254, 0.0546258419589, 0.0545517749927,
                             0.0551357587413, 0.0551173565788, 0.0590777886122, 0.0590650619576, 0.0551041970065,
                             0.05511635762, 0.0545531810768, 0.0546092680484, 0.0553988606925, 0.0555696901728,
                             0.0597289190997],
                            [0.059402515859, 0.0552762337894, 0.0552038867044, 0.0544428415616, 0.0543666696637,
                             0.0550160487462, 0.0548479291377, 0.0587428807481, 0.0587185929135, 0.0548091731863,
                             0.0549669837462, 0.0543623068361, 0.0544448671178, 0.0552367524698, 0.0552180429169,
                             0.0593343023133],
                            [0.0593206861852, 0.0551468150457, 0.0551827485874, 0.0543478424858, 0.0542746313118,
                             0.0549742528775, 0.0547678286547, 0.058708900839, 0.0586790051031, 0.0547331865532,
                             0.0549066867742, 0.0542919417955, 0.0543670258814, 0.055178126521, 0.0551546246353,
                             0.0592807189855],
                            [0.0595241002248, 0.0553061650689, 0.0551132583219, 0.054358976916, 0.0542822520559,
                             0.0549231539575, 0.0549449874065, 0.0589051642864, 0.058880522136, 0.0548889559286,
                             0.0549109907263, 0.0542998945445, 0.0543725133015, 0.0551086203994, 0.0552705986966,
                             0.0594642224428],
                            [0.0598090328053, 0.0554586180655, 0.0555804208183, 0.0547006228427, 0.0546308937237,
                             0.0554115775202, 0.0551035770499, 0.0592276314718, 0.0592392196022, 0.0551161035764,
                             0.0554128079019, 0.0546615267591, 0.0546865733475, 0.0555975478352, 0.055473233059,
                             0.0597228139634],
                            [0.0676000331643, 0.0597912558888, 0.0596872519365, 0.0590241454846, 0.0589861979778,
                             0.0595225950185, 0.0595047653339, 0.0672261214785, 0.067152745677, 0.0594740429346,
                             0.0594737172787, 0.0589487337559, 0.0590117930399, 0.0596871176127, 0.0597883274633,
                             0.0676951062825],
                            [0.0676932801322, 0.0598759487511, 0.0597572112124, 0.0591173882868, 0.0590191463255,
                             0.0595569318445, 0.0595023376041, 0.0671188595997, 0.0672454779263, 0.0595140239864,
                             0.0595706079039, 0.0590289688424, 0.0590768476304, 0.0597310449458, 0.0598856974221,
                             0.0676203241345],
                            [0.0597891715819, 0.0555406117992, 0.055658840545, 0.0547349816208, 0.0546513892406,
                             0.0553689943716, 0.0551084307464, 0.0592640908947, 0.0592739811014, 0.0551726520298,
                             0.0554303145372, 0.0546923037107, 0.0547337353066, 0.0556077633802, 0.0554685054953,
                             0.0598007251048],
                            [0.0595567466784, 0.0553146399369, 0.0551222229853, 0.0544026089073, 0.0542884876266,
                             0.0549029988356, 0.0549555422666, 0.0589542783177, 0.0589517696555, 0.0549841853737,
                             0.0550330885043, 0.0543558957401, 0.0543847865839, 0.0551193570742, 0.0553044030778,
                             0.0594814824081],
                            [0.0593080188185, 0.0551937543086, 0.055170763233, 0.0543493107985, 0.0542890030349,
                             0.0549742727661, 0.0547657126454, 0.0587341466747, 0.058703697539, 0.0548359835113,
                             0.0550336911455, 0.054302066522, 0.0544038917648, 0.0552008183037, 0.0551549673977,
                             0.0592835553019],
                            [0.0593976082659, 0.0552750552045, 0.055274232861, 0.0544731081823, 0.0543986332339,
                             0.0550887967315, 0.0548270823695, 0.0588063842883, 0.0588015820717, 0.0548552682181,
                             0.0550759501673, 0.054382727736, 0.0545281849744, 0.055274242113, 0.0552773106549,
                             0.0594119271805],
                            [0.059777944694, 0.0556326275363, 0.0554243847292, 0.0546559753552, 0.0545708496069,
                             0.0551823495313, 0.0551703577813, 0.0591639544338, 0.0591834882265, 0.0552146878243,
                             0.0551542469532, 0.0545792181063, 0.0546803920471, 0.0554526980185, 0.0556099266207,
                             0.0598120110269],
                            [0.0603023777487, 0.0560031826434, 0.0561226151621, 0.0552029450244, 0.0551167294769,
                             0.0558474269448, 0.0555550183784, 0.0596251211111, 0.0596112155021, 0.0555327909008,
                             0.0558633830664, 0.0550852763903, 0.0551933033446, 0.0560989651374, 0.0560350908371,
                             0.0602945615677],
                            [0.0681879874087, 0.060513958307, 0.0604029042813, 0.059706274283, 0.0596274100882,
                             0.0601639022597, 0.0601214907587, 0.0677466686758, 0.0676617092813, 0.0600612583969,
                             0.0601500778009, 0.0596202680667, 0.0597034586063, 0.0603757437164, 0.0605242460192,
                             0.0683309968857]], dtype=np.float32)
        sigma_r = np.array([[0.078051461385, 0.0709051921827, 0.0703748006119, 0.0694865971898, 0.0692158004218,
                             0.0695262755875, 0.069428109736, 0.0758480209087, 0.0758991596872, 0.069368197184,
                             0.0695057018834, 0.069158067885, 0.0694148927305, 0.0703606461421, 0.070881321274,
                             0.0778892707168],
                            [0.0706908458929, 0.0664626900331, 0.0660689815362, 0.0649707531709, 0.0646691164075,
                             0.0651766010515, 0.0648476402491, 0.0682780902707, 0.0682499304211, 0.0648291427162,
                             0.0651541143906, 0.0646149341756, 0.0649099957518, 0.0660870571213, 0.0664299726193,
                             0.0706347363929],
                            [0.0697798355628, 0.0656115576175, 0.0649763862774, 0.0639855417629, 0.0636988049046,
                             0.0640742769186, 0.064015933684, 0.0673905354183, 0.0673799115466, 0.063975756394,
                             0.0640544577012, 0.0636912880939, 0.0639610167705, 0.0649596721748, 0.0656076182162,
                             0.0697600013234],
                            [0.0691574464615, 0.0650371931605, 0.0644528661407, 0.0634928408267, 0.0632431247766,
                             0.0636774755518, 0.0634866523873, 0.0668310937151, 0.0668086931152, 0.0634158006917,
                             0.0636236416721, 0.0632148651209, 0.0635060992399, 0.0645200416908, 0.0650035052207,
                             0.0691054172997],
                            [0.0688555592931, 0.0646636531806, 0.064216825393, 0.0631836346814, 0.062941761373,
                             0.0634754169581, 0.0632480309321, 0.0665922473886, 0.0666253523334, 0.0632174940253,
                             0.0634172668277, 0.0629665637614, 0.0631970409807, 0.0642268652578, 0.0647103585534,
                             0.0688341612178],
                            [0.0688853926168, 0.0646819111696, 0.0640411943578, 0.0631130279151, 0.0628697274843,
                             0.0633336841666, 0.0633349351698, 0.066742810931, 0.0667698079989, 0.0632974410132,
                             0.0633566665059, 0.0629161267636, 0.063113676743, 0.064081507624, 0.0647024445458,
                             0.0688967575989],
                            [0.0690773856921, 0.0647460149061, 0.0643775136758, 0.0633567348087, 0.063130474476,
                             0.0637461011213, 0.0634535881075, 0.067032625442, 0.0670975861443, 0.0634905203606,
                             0.0637677120688, 0.0631894283203, 0.0633513631189, 0.0644264306527, 0.0647905852649,
                             0.0690619096871],
                            [0.0757907278892, 0.0684292696915, 0.0678979749723, 0.0670580165858, 0.0668747247146,
                             0.0672845704034, 0.0672416144992, 0.0740608453236, 0.0740550000821, 0.0672439812522,
                             0.0672713070928, 0.0668691981812, 0.067032531646, 0.0679247588684, 0.068427860934,
                             0.0758862539965],
                            [0.0758561958295, 0.0684409985598, 0.0678982526449, 0.0670722045188, 0.0668598076993,
                             0.0672728969853, 0.0672143076225, 0.0739069984752, 0.0740527234306, 0.0672242551665,
                             0.0672847480543, 0.066876868266, 0.06704376626, 0.0678905130589, 0.068458643889,
                             0.0757711822511],
                            [0.0690787745235, 0.0648057348408, 0.0644184728527, 0.0633585939594, 0.0631589701855,
                             0.0636958235953, 0.0634342551959, 0.0670189666702, 0.0670376742314, 0.0634611219663,
                             0.0637187035377, 0.063151562942, 0.0633231371932, 0.0643804794767, 0.0647532377617,
                             0.0690850556753],
                            [0.0689547520605, 0.0646823308772, 0.0640482714595, 0.0631198637774, 0.0628671924475,
                             0.0633292930222, 0.0633356537554, 0.0667776851813, 0.0668173379163, 0.0633543483358,
                             0.063391213345, 0.0628930106222, 0.0630803068844, 0.0640277908148, 0.0646988797085,
                             0.0688877914029],
                            [0.0688740102415, 0.0647063327095, 0.0642085018547, 0.0631803514128, 0.0629429724124,
                             0.0634589225951, 0.0632608450292, 0.0666370356139, 0.0666255903627, 0.06328488462,
                             0.0634940568144, 0.0629507600716, 0.0632202197519, 0.064198165554, 0.0647181275217,
                             0.068863924576],
                            [0.0691567083218, 0.0650106067677, 0.0645166434577, 0.0634913755866, 0.0632321012557,
                             0.0637286059724, 0.0634942771003, 0.0668875855502, 0.0668734788474, 0.0634704591995,
                             0.0637472707366, 0.0632510595589, 0.0635375103987, 0.0645240511416, 0.0650611700163,
                             0.0691774352738],
                            [0.0698079284216, 0.0656697129523, 0.064975051027, 0.0639750510958, 0.0636985176637,
                             0.0641296712238, 0.0640326860437, 0.0674646213607, 0.0674525474014, 0.0640768916359,
                             0.0641311104444, 0.0637680275454, 0.0640592242261, 0.0650667428372, 0.0657124432781,
                             0.0698803099767],
                            [0.0707226328466, 0.0664834560767, 0.0660999841637, 0.0649634588509, 0.0646661786923,
                             0.0652025375558, 0.0648473159519, 0.068315946201, 0.0683470751899, 0.0648773862988,
                             0.0652427826122, 0.0647432017957, 0.0650374045137, 0.0661387530202, 0.0665777736135,
                             0.0707426288331],
                            [0.0780377060991, 0.0709775391433, 0.070446793309, 0.0695116399594, 0.0692441717854,
                             0.0695943014651, 0.06948036246, 0.0760434460202, 0.0760171362842, 0.06947287323,
                             0.0695954119176, 0.0692698883378, 0.0695404788384, 0.0704577925772, 0.0710026080444,
                             0.0781671738577]], dtype=np.float32)
    return sigma_b, sigma_g, sigma_r


def get_sigma_c3(QF):
    sigma_b, sigma_g, sigma_r = generate_sigma(QF)
    sigma = np.zeros([2400, 2400, 3])
    for y in range(sigma.shape[0]):
        for x in range(sigma.shape[1]):
            _y = y % 16
            _x = x % 16
            sigma[y, x, 0] = sigma_b[_y, _x]
            sigma[y, x, 1] = sigma_g[_y, _x]
            sigma[y, x, 2] = sigma_r[_y, _x]
    return sigma


def get_sigma_c1(QF):
    sigma_b, sigma_g, sigma_r = generate_sigma(QF)
    _sigma = np.sqrt(sigma_b ** 2 + sigma_g ** 2 + sigma_r ** 2)
    sigma = np.zeros([2560, 2560, 1])
    for y in range(sigma.shape[0]):
        for x in range(sigma.shape[1]):
            _y = y % 16
            _x = x % 16
            sigma[y, x, 0] = _sigma[_y, _x]
    return sigma


def get_sigma_Y(QF):
    _sigma = np.load('DIV2K_Y_QF' + str(QF) + '.npy')
    sigma = np.zeros([256, 256, 1])
    for y in range(sigma.shape[0]):
        for x in range(sigma.shape[1]):
            _y = y % 8
            _x = x % 8
            sigma[y, x, 0] = _sigma[_y, _x, 0]
    return sigma


# Testing running time
def test_time(model):
    # a = cv2.imread('../flex_jpeg/datas/WIN143_resize/001.png')
    # a = a.astype(np.float32)/255.0
    # a = a.reshape((1,)+a.shape)
    a = np.random.random((1, 512, 512, 3))
    for i in range(20):
        start = time.clock()
        b = model.predict(a)
        end = time.clock()
        print(end - start)


def data_augmentation(x, method):
    if method == 0:
        return np.rot90(x)
    if method == 1:
        return np.fliplr(x)
    if method == 2:
        return np.flipud(x)
    if method == 3:
        return np.rot90(np.rot90(x))
    if method == 4:
        return np.rot90(np.fliplr(x))
    if method == 5:
        return np.rot90(np.flipud(x))


def generate_anchors(shape, size, step):
    def process_line(l, step):
        pos = 0
        pos_list = []
        while (pos < l):
            if (pos + size) <= l:
                pos_list.append(pos)
            else:
                pos_list.append(l - size)
            pos += step
        return pos_list

    h = shape[0]
    w = shape[1]
    pos_list = []
    h_list = process_line(h, step)
    w_list = process_line(w, step)
    for i in range(len(h_list)):
        for j in range(len(w_list)):
            pos_list.append((h_list[i], w_list[j]))
    return pos_list


def getPatchFromAnchors(gt, ns, size, anchors):
    gt_list = []
    ns_list = []
    if len(gt.shape) == 2:
        gt = np.expand_dims(gt, 2)
    if len(ns.shape) == 2:
        ns = np.expand_dims(ns, 2)
    for anchor in anchors:
        x, y = anchor
        gt_list.append(gt[x:x + size, y:y + size])
        ns_list.append(ns[x:x + size, y:y + size])
    return np.array(gt_list), np.array(ns_list)


def getImageFromPatch(patches, anchors):
    size = patches.shape[1]
    h = 0
    w = 0
    c = patches.shape[3]
    for anchor in anchors:
        h = max(h, anchor[0] + size)
        w = max(w, anchor[1] + size)
    _weights = np.ones((size, size, c), dtype=np.float32)
    img = np.zeros((h, w, c), dtype=np.float32)
    weights = np.zeros((h, w, c), dtype=np.float32)
    index = 0
    for anchor in anchors:
        _y, _x = anchor
        weights[_y:_y + size, _x:_x + size, :] += _weights
        img[_y:_y + size, _x:_x + size, :] += patches[index]
        index += 1
    img /= weights
    return img


def convertToFloat(x):
    return x.astype(np.float32) / 255.0


def generate_sigma_Y(QF):
    file_list = os.listdir('F:/dataset/DIV2K/DIV2K_train_HR/')
    file_list = list_filter(file_list, '.png')
    data_list = []
    for f in file_list:
        print('processing ' + f, end='\r')
        s = str.split(f, '.')
        img = cv2.imread('F:/dataset/DIV2K/DIV2K_JPEG/y/' + f, cv2.IMREAD_GRAYSCALE)
        jpg = cv2.imread('F:/dataset/DIV2K/QF' + str(QF) + '/y/' + s[0] + '.jpg', cv2.IMREAD_GRAYSCALE)
        img = img.astype(np.float32) / 255.0
        jpg = jpg.astype(np.float32) / 255.0
        diff = img - jpg
        step = 8
        for i in range(0, diff.shape[0] - step, step):
            for j in range(0, diff.shape[1] - step, step):
                _d = diff[i:i + step, j:j + step]
                data_list.append(_d)
    data_array = np.array(data_list)
    r = np.sqrt(np.mean(data_array ** 2, axis=0))
    print(np.round(r, 3))
    np.save('DIV2K_Y_QF' + str(QF) + '.npy', r.reshape(r.shape + (1,)))
